@using Domain;
@model List<Usuario>
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Usuarios";
}
<div class="container mt-5" style="text-align:center">
    <div class="d-flex justify-content-center"></div>
    <h1>Gestión de Usuarios</h1>
</div>
<div class="row"><div class="col space"></div></div>
<div>
    <table id="usuariosTable" class="table text-center">
        <thead class="thead-dark">
            <tr>
                <th scope="col" class="col-2">Equipo</th>
                <th scope="col" class="col-2">Nombre</th>
                <th scope="col" class="col-2">Apellido</th>
                <th scope="col" class="col-2">Correo</th>
                <th scope="col" class="col-2">Tipo</th>
                <th scope="col" class="col-2">Acción</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var user in Model)
            {
                <tr>
                    <td class="align-middle">
                        @if (@user.Equipo == 1)
                        {
                            <img src="~/media/logoESPE.png" alt="Logo SPE" style="width:30px" />
                        }
                        else if (@user.Equipo == 2)
                        {
                            <img src="~/media/logoEPN.png" alt="Logo SPE" style="width:30px" />
                        }
                        else if (@user.Equipo == 3)
                        {
                            <img src="~/media/logoESPOCH.png" alt="Logo SPE" style="width:30px" />
                        }
                        else if (@user.Equipo == 4)
                        {
                            <img src="~/media/logoESPOL.png" alt="Logo SPE" style="width:100px" />
                        }
                        else if (@user.Equipo == 5)
                        {
                            <img src="~/media/logoUCE.png" alt="Logo SPE" style="width:30px" />
                        }
                        else if (@user.Equipo == 6)
                        {
                            <img src="~/media/logoUPSE.png" alt="Logo SPE" style="width:30px" />
                        }
                    </td>
                    <td class="align-middle">@user.Nombre</td>
                    <td class="align-middle">@user.Apellido</td>
                    <td class="align-middle">@user.Email</td>
                    <td class="align-middle">@(user.IsActive ? "Activo" : "Reserva")</td>
                    <td class="align-middle">
                        <a class="btn btn-warning" title="Editar" data-bs-toggle="modal" data-bs-target="#EditarUser" data-id="@user.Id">
                            <i class="fas fa-pencil-alt"></i>
                         </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@*Modales*@

<form asp-controller="Juez" asp-action="EditarUsuario" method="post" class="form w-100">
    <div class="modal fade" tabindex="-1" id="EditarUser">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Editar Usuario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-6">
                        <label class="col-lg-4 col-form-label fw-semibold fs-6">Nombre</label>
                        <div class="col-lg-8 fv-row">
                            <input id="inputNombre" type="text" placeholder="Nombre" name="Nombre" class="form-control bg-transparent"/>
                            <input id="inputid" type="text" placeholder="Id" name="Id" class="form-control bg-transparent" hidden />
                        </div>
                    </div>
                    <div class="row mb-6 mt-3">
                        <label class="col-lg-4 col-form-label fw-semibold fs-6">Apellido</label>
                        <div class="col-lg-8 fv-row">
                            <input id="inputApellido" type="text" placeholder="Apellido" name="Apellido" class="form-control bg-transparent"/>
                        </div>
                    </div>
                    <div class="row mb-6 mt-3">
                        <label class="col-lg-4 col-form-label fw-semibold fs-6">Email</label>
                        <div class="col-lg-8 fv-row">
                            <input id="inputEmail" type="text" placeholder="Email" name="Email" class="form-control bg-transparent"/>
                        </div>
                    </div>
                    <div class="row mb-6 mt-3">
                        <label class="col-lg-4 col-form-label fw-semibold fs-6">Tipo de Usuario</label>
                        <div class="col-lg-8 fv-row">
                            <select name="Estado" class="form-select" id="floatingSelect" aria-label="Floating label select example">
                                <option selected>Seleccione el estado del usuario</option>
                                <option value="True">Activo</option>
                                <option value="False">Reserva</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary">Guardar cambios</button>
                </div>
            </div>
        </div>
    </div>
</form>

    <div class="modal fade" tabindex="-1" id="VerUser">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Usuario</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-6">
                    <label class="col-lg-4 col-form-label fw-semibold fs-6">Nombre</label>
                    <div class="col-lg-8 fv-row">
                        <input id="inputNombre" type="text" placeholder="Tipo de descuento" name="DescripcionDescuento" class="form-control bg-transparent" readonly/>
                        <input id="inputid" type="text" placeholder="Tipo de descuento" name="DescripcionDescuento" class="form-control bg-transparent" hidden/>
                    </div>
                </div>
                <div class="row mb-6 mt-3">
                    <label class="col-lg-4 col-form-label fw-semibold fs-6">Apellido</label>
                    <div class="col-lg-8 fv-row">
                        <input id="inputApellido" type="text" placeholder="Tipo de descuento" name="DescripcionDescuento" class="form-control bg-transparent" readonly />
                    </div>
                </div>
                <div class="row mb-6 mt-3">
                    <label class="col-lg-4 col-form-label fw-semibold fs-6">Email</label>
                    <div class="col-lg-8 fv-row">
                        <input id="inputEmail" type="text" placeholder="Tipo de descuento" name="DescripcionDescuento" class="form-control bg-transparent" readonly />
                    </div>
                </div>
                <div class="row mb-6 mt-3">
                    <label class="col-lg-4 col-form-label fw-semibold fs-6">Tipo de Usuario</label>
                    <div class="col-lg-8 fv-row">
                        <input id="inputReserva" type="text" placeholder="Tipo de descuento" name="DescripcionDescuento" class="form-control bg-transparent" readonly />
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

@section scripts{
    <script>
        $(document).ready(function () {
            $('#usuariosTable').DataTable({
                "paging": true,          
                "lengthChange": false,   
                "searching": true,
                "info": true,            
                "autoWidth": true,       
                "pageLength": 10,
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json"
                }
            });
        });

        document.addEventListener('DOMContentLoaded', function () {
            debugger;
            const buttons = document.querySelectorAll('[data-bs-target="#VerUser"]');

            buttons.forEach((button, index) => {
                button.addEventListener('click', e => {
                    let Nombre = button?.parentElement.parentElement?.children[1].textContent;
                    let Apellido = button?.parentElement.parentElement?.children[2].textContent;
                    let Email = button?.parentElement.parentElement?.children[3].textContent;
                    let Reserva = button?.parentElement.parentElement?.children[4].textContent;
                    let idUser = button.getAttribute('data-id');
                    console.log(Nombre);
                    console.log(Apellido);
                    console.log(Email);
                    console.log(Reserva);
                    console.log(idUser);
                    cambiaValores(Nombre, Apellido, Email, Reserva, idUser);
                });

                function cambiaValores(Nombre, Apellido, Email, Reserva, idUser) {
                    var inputNombre = document.getElementById("inputNombre");
                    var inputApellido = document.getElementById("inputApellido");
                    var inputEmail = document.getElementById("inputEmail");
                    var inputReserva = document.getElementById("inputReserva");
                    var inputid = document.getElementById("inputid");

                    inputid.value = idUser;
                    inputNombre.value = Nombre;
                    inputApellido.value = Apellido;
                    inputEmail.value = Email;
                    inputReserva.value = Reserva;
                }
            });
        });
        document.addEventListener('DOMContentLoaded', function () {
            debugger;
            const buttons = document.querySelectorAll('[data-bs-target="#EditarUser"]');

            buttons.forEach((button, index) => {
                button.addEventListener('click', e => {
                    let Nombre = button?.parentElement.parentElement?.children[1].textContent;
                    let Apellido = button?.parentElement.parentElement?.children[2].textContent;
                    let Email = button?.parentElement.parentElement?.children[3].textContent;
                    let Reserva = button?.parentElement.parentElement?.children[4].textContent;
                    let idUser = button.getAttribute('data-id');
                    console.log(Nombre);
                    console.log(Apellido);
                    console.log(Email);
                    console.log(Reserva);
                    console.log(idUser);
                    cambiaValores(Nombre, Apellido, Email, Reserva, idUser);
                });

                function cambiaValores(Nombre, Apellido, Email, Reserva, idUser) {
                    var inputNombre = document.getElementById("inputNombre");
                    var inputApellido = document.getElementById("inputApellido");
                    var inputEmail = document.getElementById("inputEmail");
                    var inputReserva = document.getElementById("inputReserva");
                    var inputid = document.getElementById("inputid");

                    inputid.value = idUser;
                    inputNombre.value = Nombre;
                    inputApellido.value = Apellido;
                    inputEmail.value = Email;
                    inputReserva.value = Reserva;
                }
            });
        });
    </script>
}
